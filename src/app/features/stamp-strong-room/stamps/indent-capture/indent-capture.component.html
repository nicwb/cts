<div class="grid">
    <div class="col-12">
        <app-common-header [headerName]="'Indent Capture'" [imgSrc]="'assets/layout/images/icons/indent-entry.png'">
            <button pButton pRipple (click)="showInsertDialog()" type="button" icon="pi pi-plus" label="New Entry"
                class="p-button-rounded p-button-raised"></button>
        </app-common-header>
    </div>
    <app-from-to-date class="mx-auto" (newItemEvent)="search($event)" [buttonLabel]="'Search'" [heading]="'Search Indents'"></app-from-to-date>
    <div class="col-12">
        <mh-prime-dynamic-table (actionButtonClicked)="handleButtonClick($event)" [numberRowsShown]="10"
            [rowsPerPageOptions]="[10,30,50]" [actionButtons]="tableActionButton" [showTopMenubar]="true"
            [data]="tableData" [isLoading]="isLoading">
        </mh-prime-dynamic-table>
    </div>
</div>

<p-dialog header="Stamp Indent" [(visible)]="displayInsertModal" [modal]="false" [style]="{width: '95%'}"
    [baseZIndex]="10000">

    <hr class="my-2"/>
    <form [formGroup]="stampIndentForm" class="flex flex-column gap-4 my-3">
        <div class="flex flex-column gap-3">
            <div class="flex gap-2 xl:flex-row flex-column">
                <div class="flex-1">
                    <label for="memoNo" class="block mb-1 font-medium text-900">Memo No:</label>
                    <input type="text" pinputtext="" formControlName="memoNo" placeholder="Eg: MEMO5256"
                        class="p-inputtext p-component p-element w-full">
                    <div
                        *ngIf="stampIndentForm.controls['memoNo'].errors && (stampIndentForm.controls['memoNo'].dirty || stampIndentForm.controls['memoNo'].touched)">
                        <small class="p-error" *ngIf="stampIndentForm.controls['memoNo'].errors['required']">Memo No is
                            required.</small>
                    </div>
                </div>
                <div class="flex-1">
                    <label for="memoDate" class="block mb-1 font-medium text-900">Memo Date</label>
                    <p-calendar class="p-component p-element w-full p-calendar" formControlName="memoDate"
                        placeholder="mm/dd/yyyy" appendTo="body" [showIcon]="true" inputId="icon"></p-calendar>
                    <div
                        *ngIf="stampIndentForm.controls['memoDate'].errors && (stampIndentForm.controls['memoDate'].dirty || stampIndentForm.controls['memoDate'].touched)">
                        <small class="p-error" *ngIf="stampIndentForm.controls['memoDate'].errors['required']">Memo Date is
                            required.</small>
                    </div>
                </div>
            <!-- </div>
            <div class="flex gap-2 xl:flex-row flex-column"> -->
                <div class="col-12 p-0 flex-1">
                    <label for="remarks" class="block mb-1 font-medium text-900">Remarks</label>
                    <input type="text" pinputtext="" formControlName="remarks" placeholder="Eg: Indent for Kolkata treasury."
                        class="p-inputtext p-component p-element w-full" />
                    <div
                        *ngIf="stampIndentForm.controls['remarks'].errors && (stampIndentForm.controls['remarks'].dirty || stampIndentForm.controls['remarks'].touched)">
                        <small class="p-error" *ngIf="stampIndentForm.controls['remarks'].errors['required']">Remarks are
                            required.</small>
                        <small class="p-error" *ngIf="stampIndentForm.controls['remarks'].errors['minlength']">Remarks must
                            be at least {{ stampIndentForm.controls['remarks'].errors['maxlength'].requiredLength }}
                            characters long.</small>
                    </div>
                </div>
                <div class="flex-1">
                    <label for="toTreasury" class="block mb-1 font-medium text-900">To Treasury (<span
                            class="font-medium text-base text-gray-900">Default: </span><span
                            class="font-medium text-base text-gray-500">Superintendent</span>)</label>
                    <app-treasury-dropdown (treasurySelected)="onTreasurySelected($event)"></app-treasury-dropdown>
                </div>
            </div>
        </div>
    </form>
    <hr class="my-4"/>
    <!-- <hr/> -->
    <div class="w-full border-rounded pb-2 flex flex-column gap-2 align-items-start">
        <h5 class="text-red-500 p-0 m-0">Current Balance</h5>
        <div class="flex gap-4 align-items-center justify-content-between w-full">
            <div class="flex flex-column align-items-start gap-2 w-full">
                <label class="block mb-1 text-gray-500 font-medium" for="category">Category</label>
                <input pinputtext="" disabled type="text" [value]="category" class="pl-1 w-full border-rounded py-1">
            </div>
            <div class="flex flex-column align-items-start gap-2 w-full">
                <label class="block mb-1 text-gray-500 font-medium" for="denom">Denomination</label>
                <input pinputtext="" disabled type="text" [value]="denom" class="pl-1 w-full border-rounded py-1">
            </div>
            <div class="flex flex-column align-items-start gap-2 w-full">
                <label class="block mb-1 text-gray-500 font-medium" for="noOfSheets">No of sheets</label>
                <input pinputtext="" disabled type="text" [value]="noOfSheetsInStock" class="pl-1 w-full border-rounded py-1">
            </div>
            <div class="flex flex-column align-items-start gap-2 w-full">
                <label class="block mb-1 text-gray-500 font-medium" for="noOfLabels">No of labels</label>
                <input pinputtext="" disabled type="text" [value]="noOfLabelsInStock" class="pl-1 w-full border-rounded py-1">
            </div>
        </div>
    </div>
    <hr />
    <div class="flex gap-2 align-items-end w-full">
        <div class="p-0 flex-1">
            <label for="Category" class="block mb-1 font-medium text-900">Combination</label>
            <app-stamp-combination-dropdown
                (StampCombinationSelected)="onStampCombinationSelected($event)"></app-stamp-combination-dropdown>
        </div>

        <div class="flex-1">
            <label for="Description" class="block mb-1 font-medium text-900">Description</label>
            <input type="text" pinputtext="" [value]="description" readonly disabled
                class="p-inputtext p-component p-element w-full">
        </div>
        <div class="flex-1">
            <label for="denomination" class="block mb-1 font-medium text-900">Denomination (Rs.)</label>
            <input type="number" pinputtext="" [value]="denomination" readonly disabled
                class="p-inputtext p-component p-element w-full">
        </div>
        <div class="flex-1">
            <label for="labelPerSheet" class="block mb-1 font-medium text-900">Label/Sheet</label>
            <input type="text" pinputtext="" [value]="labelPerSheet" readonly disabled
                class="p-inputtext p-component p-element w-full">
        </div>
        <div class="flex-1">
            <label for="noOfSheets" class="block mb-1 font-medium text-900">No: of Sheets</label>
            <input type="number" pinputtext="" [(ngModel)]="sheet"
                (ngModelChange)="sheetSelected($event)" placeholder="Eg: 10"
                class="p-inputtext p-component p-element w-full">
            <!-- <div
                *ngIf="sheetEmpty">
                <small class="p-error" *ngIf="sheetEmpty">No of
                    Sheets is required.</small>
                <small class="p-error" *ngIf="sheetNegative">No of
                    Sheets must be a valid number.</small>
            </div> -->
        </div>
        <div class="flex-1">
            <label for="noOfLabels" class="block mb-1 font-medium text-900">No: of Labels</label>
            <input type="number" pinputtext="" [(ngModel)]="label"
                (ngModelChange)="labelSelected($event)" placeholder="Eg: 10"
                class="p-inputtext p-component p-element w-full">
            <!-- <div
                *ngIf="labelEmpty">
                <small class="p-error" *ngIf="labelEmpty">No of
                    Labels is required.</small>
                <small class="p-error" *ngIf="labelNegative">No of
                    Labels must be a valid number.</small>
            </div> -->
        </div>
        <div class="flex-1">
            <label for="quantity" class="block mb-1 font-medium text-900">Quantity</label>
            <input type="text" pinputtext="" readonly disabled [value]="quantity"
                class="p-inputtext p-component p-element w-full">
        </div>
        <div class="flex-1">
            <label for="amount" class="block mb-1 font-medium text-900">Amount (Rs.)</label>
            <input type="text" pinputtext="" readonly disabled [value]="amount"
                class="p-inputtext p-component p-element w-full">
        </div>
    </div>
    <div class="flex gap-2 justify-content-start py-3">
        <p-button [loading]="loading" label="Add New" (click)="addItems()" class="rounded">
        </p-button>
    </div>
    <p-table [value]="indentList" [rowHover]="true" styleClass="p-datatable-gridlines" responsiveLayout="scroll">
        <ng-template pTemplate="header">
            <tr >
                <th style="min-width: 12rem">Combination ID</th>
                <th style="min-width: 12rem">Description</th>
                <th style="min-width: 12rem">Denomination</th>
                <th style="min-width: 12rem">Label/Sheet</th>
                <th style="min-width: 12rem">Sheet</th>
                <th style="min-width: 12rem">Label</th>
                <th style="min-width: 12rem">Quantity</th>
                <th style="min-width: 12rem">Amount</th>
                <th style="min-width: 12rem">Actions</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-indentList>
            <tr class="p-selectable-row">
                <td style="min-width: 12rem">{{ indentList.stampCombinationId }}</td>
                <td style="min-width: 12rem">{{ indentList.description }}</td>
                <td style="min-width: 12rem">{{ indentList.denomination }}</td>
                <td style="min-width: 12rem">{{ indentList.labelPerSheet }}</td>
                <td style="min-width: 12rem">{{ indentList.sheet }}</td>
                <td style="min-width: 12rem">{{ indentList.label }}</td>
                <td style="min-width: 12rem">{{ indentList.quantity }}</td>
                <td style="min-width: 12rem">{{ indentList.amount }}</td>
                <td>
                    <p-button 
                        icon="pi pi-trash" 
                        severity="danger" 
                        (onClick)="deleteProduct(indentList)"></p-button>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="9">No Data Available</td>
            </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody">
            <tr>
                <td colspan="12">Loading Employee Accounts. Please wait.</td>
            </tr>
        </ng-template>
    </p-table>
    <div class="flex justify-content-end align-content-center py-3">
        <p-button [loading]="loading" label="Submit" (click)="addStampIndent()" class="rounded">
        </p-button>
    </div>
</p-dialog>