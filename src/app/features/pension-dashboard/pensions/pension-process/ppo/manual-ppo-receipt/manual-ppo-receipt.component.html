<div class="grid">
    <div class="col-12">
        <app-common-header [headerName]="'Manual PPO Receipt'" [imgSrc]="'assets/layout/images/icons/ppo-receipt.png'">
            <button pButton pRipple (click)="openNewPpoReceiptForm()" type="button" icon="pi pi-plus" label="New Manual PPO Entry"
                class="p-button-rounded p-button-raised"></button>
        </app-common-header>
        <div class="col-12">
            <!-- Load PPO Receipt Button -->
            <button pButton pRipple (click)="loadPpoReceipts()" type="button" icon="pi pi-download" label="Load PPO Receipt"
                class="p-button-rounded p-button-raised"></button>
        </div>
    </div>

    <!-- PPO Table and Placeholder -->
    <div class="col-12">
        <!-- Dynamic Table Component -->
        <mh-prime-dynamic-table *ngIf="isTableVisible"
            size="small"
            [data]="tableData"
            [numberRowsShown]="10"
            [rowsPerPageOptions]="[10, 30, 50]"
            [showTopMenubar]="true"
            [isLoading]="isDataLoading"
            [actionButtons]="actionButtons"
            (actionButtonClicked)="onActionButtonClick($event)"
            (queryParameterChange)="onQueryParametersChange($event)"
            (searchKeyChange)="onSearchKeyChange($event)">
        </mh-prime-dynamic-table>

        <!-- Placeholder when table is not visible -->
        <div class="svg-placeholder-container" *ngIf="!isTableVisible" style="display: flex; justify-content: center; align-items: center; height: calc(100vh - 300px); flex-direction: column;">
            <svg
                width="250"
                height="250"
                viewBox="0 0 100 100"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
            >
                <!-- Document Outline -->
                <rect
                    x="15"
                    y="10"
                    width="70"
                    height="80"
                    rx="5"
                    stroke="#8B9DA6"
                    stroke-width="2"
                    fill="white"
                />
                <!-- Lines representing text -->
                <line
                    x1="20"
                    y1="25"
                    x2="80"
                    y2="25"
                    stroke="#8B9DA6"
                    stroke-width="2"
                    stroke-linecap="round"
                />
                <line
                    x1="20"
                    y1="35"
                    x2="80"
                    y2="35"
                    stroke="#8B9DA6"
                    stroke-width="2"
                    stroke-linecap="round"
                />
                <line
                    x1="20"
                    y1="45"
                    x2="75"
                    y2="45"
                    stroke="#8B9DA6"
                    stroke-width="2"
                    stroke-linecap="round"
                />
                <line
                    x1="20"
                    y1="55"
                    x2="80"
                    y2="55"
                    stroke="#8B9DA6"
                    stroke-width="2"
                    stroke-linecap="round"
                />
                <line
                    x1="20"
                    y1="65"
                    x2="60"
                    y2="65"
                    stroke="#8B9DA6"
                    stroke-width="2"
                    stroke-linecap="round"
                />
                <!-- Dotted line for processing animation -->
                <line
                    x1="20"
                    y1="75"
                    x2="70"
                    y2="75"
                    stroke="#8B9DA6"
                    stroke-width="2"
                    stroke-dasharray="5, 5"
                    stroke-linecap="round"
                >
                    <animate
                        attributeName="stroke-dashoffset"
                        values="10;0"
                        dur="1s"
                        repeatCount="indefinite"
                    />
                </line>
            </svg>
            <p style="color: #5A6C7D; font-weight: bold; font-size: 18px; margin-top: 20px;">Fetching PPO Receipts... Please wait.</p>
        </div>
    </div>
</div>

<p-dialog header="Manual PPO Receipt" [(visible)]="isInsertModalVisible" [modal]="true"
    [breakpoints]="{ '1199px': '75vw', '991px': '90vw', '575px': '100vw' }" [maximizable]="true"
    [baseZIndex]="10000">
    <form [formGroup]="manualPpoForm" class="flex flex-column gap-4 mt-3">
        <div class="flex gap-2 xl:flex-row flex-column">
            <div class="flex-auto">
                <label for="ppoNo" class="block mb-1 text-color text-lg">PPO No:</label>
                <input type="text" pInputText formControlName="ppoNo" placeholder="PPO Number" class="w-full">
                <small class="p-error" *ngIf="manualPpoForm.get('ppoNo')?.hasError('duplicate')">
                    This PPO number already exists. Please use a different PPO number.
                </small>
            </div>
        </div>

        <div class="flex gap-2 xl:flex-row flex-column">
            <div class="flex-auto">
                <label for="pensionerName" class="block mb-1 text-color text-lg">Pensioner's Name:</label>
                <input type="text" pInputText formControlName="pensionerName" placeholder="Pensioner's Name" class="w-full">
            </div>
            <div class="flex-auto">
                <label for="dateOfCommencement" class="block mb-1 text-color text-lg">Date of commencement of Pension/Family Pension:</label>
                <p-calendar formControlName="dateOfCommencement" [maxDate]="maxDate" placeholder="dd-mm-yyyy" appendTo="body" [showIcon]="true"></p-calendar>
            </div>
        </div>

        <div class="flex gap-2 xl:flex-row flex-column">
            <div class="flex-auto">
                <label for="mobileNumber" class="block mb-1 text-color text-lg">Mobile No:</label>
                <input type="text" pInputText formControlName="mobileNumber" placeholder="Mobile No" class="w-full">
            </div>
            <div class="flex-auto">
                <label for="receiptDate" class="block mb-1 text-color text-lg">Date of Receipt:</label>
                <p-calendar formControlName="receiptDate" [maxDate]="maxDate" placeholder="dd-mm-yyyy" appendTo="body" [showIcon]="true"></p-calendar>
            </div>
        </div>

        <div class="flex gap-2 xl:flex-row flex-column">
            <div class="flex-auto">
                <label for="psaCode" class="block mb-1 text-color text-lg">PPO Issued By:</label>
                <p-dropdown [options]="ppoIssuedBy" formControlName="psaCode" placeholder="Select a PPO Issued By" [showClear]="true"></p-dropdown>
            </div>
            <div class="flex-auto">
                <label for="ppoType" class="block mb-1 text-color text-lg">Type:</label>
                <p-dropdown [options]="type" formControlName="ppoType" placeholder="Select a Type" [showClear]="true"></p-dropdown>
            </div>
        </div>
    </form>
    <div class="flex gap-2 justify-content-end pt-3">
        <button *ngIf="!selectedRow" pButton label="Submit" (click)="submitPpoReceipt()"
        class="p-button-rounded" [disabled]="!manualPpoForm.valid"></button>
        <button *ngIf="selectedRow&&!isFetchUserInfo" pButton label="Update" (click)="submitPpoReceipt()"
        class="p-button-rounded" [disabled]="!manualPpoForm.valid"></button>
        <button *ngIf="isFetchUserInfo" pButton label="Update" (click)="fetchUserInfoUpdate()"
        class="p-button-rounded" [disabled]="!manualPpoForm.valid"></button>
        <button pButton label="Cancel" (click)="resetAndCloseDialog()" class="p-button-rounded"></button>
    </div>
</p-dialog>
